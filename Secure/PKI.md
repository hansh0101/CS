### 암호화폐로 이해해보는 암호화 - PKI

암호화는 암호화폐의 핵심이다. 암호화가 없으면 어떠한 거래도 보안되지 않을 것이며, 정보의 무결성도 유지되지 않을 것이다. P2P(Peer-to-Peer), 즉 개인간 전송을 수행할 때 보안 암호화 없이는 데이터가 노출될 수 있으며, 데이터가 변조되었다는 것을 알지 못한 채 데이터 구조를 읽으려고 시도할 수 있다. 바로 이 때 개인키(Private Key)와 공개키(Public Key)가 거래를 승인하는데 매우 중요한 역할을 한다.

공개키와 개인키는 모두 거래 보안을 위해 힘쓰지만, 이 둘은 목적에 있어 뚜렷하게 다르다. 이들을 비교하자면, 공개키는 거래가 요청된 후 거래를 확인하는데 사용된다. 그리고 일반적으로 공개키는 가상화폐를 받기 위한 `주소` 로도 이해된다. 반면, 가상화폐 계정과 관련된 개인키는 `거래 승인` 에 초점을 둔다.

일반적으로 개인키는 공유되지 않으며, 소유자만 알고 있어야 한다. 다시 말해, 개인키에 접근하는 권한이 부여된 사람이 있으면 지갑에 있는 자산이 사라질 수도 있다. **이것이 바로 개인키와 공개키가 무엇이며, 왜 그렇게 중요한지 이해해야 하는 이유**이다.

### 공개키(Public Key), 그리고 개인키(Private Key)란?

공개키(Public Key)와 개인키(Private Key)는 기본적으로 암호화 방법 내 복잡한 수학 알고리즘으로 암호화된 메시지를 해독하는 데 사용된다. 공개키는 널리 배포될 수 있지만, 암호화된 의미에서 사용되는 개인키는 디지털 자산을 보호하기 위한 암호로써 별도로 보관된다.

이들 개인키는 보통 256비트 암호화를 사용하지만, 암호화폐 종류에 따라 다르다. 여기에는 BTC, ETH, LTC 등이 포함된다. 예를 들어, 비트코인 개인키는 다음과 같은 값으로 형성된다.

> 0x01 and 0xFFFF FFFF FFFF FFFF FFFF FFFF FFFF FFFE BAAE DCE6 AF48 A03B BFD2 5E8C D036 4140, representing nearly the entire range of 2256-1 values.
> 

공개키 예시는 다음과 같다.

> 3048 0241 00C9 18FA CF8D EB2D EFD5 FD37 89B9 E069 EA97 FC20 5E35 F577 EE31 C4FB C6E4 4811 7D86 BC8F BAFA 362F 922B F01B 2F40 C744 2654 C0DD 2881 D673 CA2B 4003 C266 E2CD CB02 0301 0001
> 

키는 모든 사용자가 공개할 수 있거나(공개키), 소유자만 알 수 있는(개인키) 기호순서이며 이는 무작위로 형성된다. 공개키는 암호화에 사용되지만, 개인키만 사용해 정보를 해독할 수도 있다. **개인키를 알면 공개키를 알아낼 수 있지만, 공개키로 개인키를 찾는 것은 거의 불가능하다**.

암호화폐 지갑은 공개키 및 개인키 활용의 훌륭한 사례이다. 지갑에서 공개키는 사용자의 `주소` 이며, 다른 네트워크 참여자에게 토큰을 보낼 수 있는 지갑이 어디에 있는지 알려준다. 그러나 사용자가 서로 간에 암호를 전송하려면 해당 거래를 확인하기 위해서는 개인키가 필요하다.

즉, 이메일에 로그인하는 것과 마찬가지로 비밀번호가 필요하다. 이메일 주소는 다른 이메일 네트워크 참가자가 메일을 보낼 수 있는 고정된 지점이다. 이메일 계정에 대한 전체 액세스 권한을 얻으려면 암호가 필요하다.

가장 오랫동안, **대칭 암호화(Symmetric encryption)**는 모든 메시지가 동일한 키로 암호화되고 암호를 해독하는 기본 암호화 유형이었다. 그런데, 대칭 암호화가 가진 보안 능력을 완전히 신뢰하기는 어려웠다. 따라서 **비대칭 암호화(Assymmetric encryption)**는 메시지를 암호화하고 해독하는 데 별도로 사용되는 키의 쌍(공개키 하나와 개인키 하나)으로 이러한 보안 문제를 해결하도록 설계되었다.

정보를 암호화하고 해독하기 위해 하나의 키를 사용하는 대칭 암호화와 달리 공개키와 개인키는 암호화된 데이터와 `**일치**` 해야한다. 이들은 동시에 생성되고 사용된다. 그래서 이들이 암호화를 위해 어떻게 사용될까?

### 암호화폐에 사용되는 암호 방식

암호화폐의 암호화에 관해서는 **대칭 암호화(Symmetric encryption)**, **비대칭 암호화(Assymmetric encryption)**, **해싱(hashing)** 등 여러 방법이 있다.

**해싱(Hashing)**

해싱은 계정 간의 거래를 암호화하기 위해 사용자의 계정 주소를 암호로 바꾸도록 설계되었다. 암호의 보안을 유지하기 위해 저장된 값에 임의의 문자와 숫자가 추가된다. 이는 주로 암호를 어렵게 만들어 암호해독의 위험을 완화하기 위한 것이다. 저장된 값은 변환이 완료되면 디지털 지문 혹은 해시값을 참조한다.

**대칭 암호화(Symmetric Encryption)**

가장 널리 사용되며, 가장 쉬우면서도 효과적인 암호화 중 하나이다. 메시지는 같을 수도, 다를 수도 있는 단일 키로 암호화된다. 그런 다음 수신자에게 전송되고 수신 및 확인되면 암호는 해독된다.

**비대칭 암호화(Assymmetric Encryption)**

대칭과 달리 비대칭 암호화에서는 메시지의 암호화 및 암호 해독에 일반적으로 개인키와 공개키 두 가지 키가 포함된다. 공개키는 거래가 요청된 후 거래를 확인하는데 사용된다. 반면 개인키는 메시지나 거래를 해독한다. 이 개념은 거래의 진정성을 유지하고 보안이 무너지는 것을 방지한다. 즉, 개인키를 잃어버리면 개인키를 찾을 방법이 없다. 마찬가지로, 개인키가 노출되면 모든 거래가 허용될 수 있으며 공인되어 버렸기 때문에 회복할 수 없다.

### 개인키, 공개키 작동 방식

공개키(public key) 암호화에는 식별성(identification) 과 기밀성(confidentiality) 라는 두 가지 주요 이용 사례가 있다. 간단하게 아래와 같은 방법으로 설명할 수 있다.

1. 발신인은 수신인의 공개키를 가져온다.
2. 발신인은 이 키를 사용하여 정보를 암호화한다.
3. 발신인은 암호화된 정보를 수신인에게 보낸다.
4. 수신인은 개인키를 사용해 데이터의 암호를 해독한다.

![Untitled](PKI%20a06de/Untitled.png)

알렉스(발신인)가 제인(수신인)에게 1BTC를 보내고 싶어한다고 가정하자. 알렉스는 제인의 공개키를 알고 거래를 암호화하는데 사용한다. 제인은 거래를 받고 알렉스가 1BTC를 전송한 것을 자신의 개인키로 해독한다. 아무도 그녀의 개인키를 모르기 때문에, 거래를 승인할 수 있는 사람은 제인밖에 없다.

가상화폐에 관한 한, 개인키는 각자가 물리적으로 소유하고 있는 것이다. 개인키는 디지털 자산을 관리하고 모든 거래를 승인할 수 있는 권한이 있음을 증명한다. 이 키를 안다면 누구든 관련 자금을 사용할 수 있다.

### 공개키(Public Key)와 개인키(Private Key)의 차이점

개인키와 공개키 둘 다 특정 거래가 서명 당사자에 의해 사용되었고 허위로 위조되지 않았음을 확인하는데 목적을 둔다. 목적은 유사하지만, 개인키와 공개키는 여러 가지 면에서 다르다. 알아둬야 할 사항은 아래와 같다.

**알고리즘과 매커니즘**

공개키 암호화에는 암호화와 암호 해독을 위한 두 개의 개별 키가 있어야 한다. 개인키는 소유자 전용이며 공개키는 누구나 사용할 수 있다. 대칭 키 암호화에 관련된 두 당사자 간 전송에는 하나의 키가 필요하다. 동일한 개인키가 정보를 암호화하고 해독하는 데 사용된다. 개인키는 암호화된 메시지를 보내는 발신인과 받는 수신인 간에 공유된다.

**수행능력**

개인키 매커니즘은 공개키보다 훨씬 더 빠르다. 개인키는 하나의 키만 필요하지만, 공개키는 두 개의 키가 필요하기 때문이다.

**프라이버시**

개인키는 기밀이며 지갑 주인 외 다른 사람에게 공개되지 않는다. 개인키가 손실되면, 이는 복원할 수 없으며 암호화된 파일도 사용할 수 없게 된다. 일반적으로 이러한 키는 복잡한 숫자를 포함하므로 기억하기는 어렵다. 개인키의 안전성은 전적으로 소유자가 어떻게 하느냐에 따라 달렸다. 개인키를 안전하게 유지하는 가장 좋은 방법은 오프라인 저장 장치를 이용하는 것이다. 반면 공개키는 모든 사용자에게 열려 있다. 공개키를 잃어버릴 일은 없다.

**디지털 서명**

웹 콘텐츠는 사용자의 개인키로 디지털 서명하고, 사용자의 공개키로 확인할 수 있다. 이렇게 하면 네트워크에서 메시지를 보낸 사람을 쉽게 식별할 수 있게 되면서, 신뢰할 수 있는 ID가 메시지를 보냈는지 확인할 수 있다.

디지털 서명은 다음과 같은 보안상 이점을 제공한다.

- **인증**: 위조할 수 없으므로 메시지나 사용자가 합법적인지 아닌지를 증명할 수 있다.
- **거부 불가능**: 통신 후 메시지를 보낸 사람이 서명을 거부할 수 없다.
- **진실성**: 서명은 수신된 메시지가 변경되지 않았음을 보증하는 역할을 한다.

**암호화와 암호 해독**

내용은 사용자의 공개키로 암호화되며 개인키로만 암호를 해독할 수 있다. 이것이 메시지 방향을 바꾸는 유일한 방법이다.

암호화는 다음과 같은 보안상 이점을 제공한다.

- **프라이버시**: 무단 접근은 불가능하다. 소유자 외에는 다른 누구도 알 수 없는 개인키를 사용함으로써 기밀성을 유지한다.
- **진실성**: 보안 공개키가 있는 암호화 프로세스는 수신된 메시지가 변경되지 않도록 보장한다.

공개키 암호화는 다양한 응용 프로그램과 시스템 소프트웨어에 의해 구현되는 수많은 프로토콜과 데이터 형식에 사용된다. 여기에는 SSL 프로토콜, SSH, 디지털 서명된 PDF 파일, OpenPGP, S/MIME 등이 포함된다. 불안정한 네트워크에서의 안전한 연결을 보장하기 위해 브라우저와 같은 소프트웨어 프로그램에 널리 적용된다. 비대칭 암호학은 블록체인 알고리즘의 기반을 형성하며, 이는 모든 가상화폐의 기반을 구성한다.

### 공개키, 개인키 암호화의 이점과 한계

완벽한 방법론이나 암호화는 없다. 여기에는 공개키와 개인키도 포함된다. 공개키, 개인키의 장단점은 다음과 같다.

**장점**

개인키 암호화 기술은 모든 기업이 중요한 정보를 보호하는 데 있어 훌륭한 방법이다. 대칭 암호화나 비대칭 암호화 둘 중 하나 어떤 것을 선택했든지 간에 둘 다 다른 여타 기술과 마찬가지로 장단점을 가진다.

대칭 암호화는 더 빠르고 쉽게 수행할 수 있다. 시스템은 파일을 암호화하거나 해독하기 위해 가역적인 수학식을 이용한다. 그러므로 이 방법은 비대칭 암호화보다 컴퓨터 리소스를 적게 필요로 한다.

동시에 개인키 암호화는 훨씬 높은 보안 수준을 제공하지만, 여기에도 여전히 약간의 문제는 존재한다. 이 방법과 관련된 주요 문제는 키 전송이다. 키를 전송하려면 안전하지 않은 형태의 통신이 필요하다. 제3자에게 데이터의 잠금을 해제하는 키에 대한 액세스 권한을 부여하는 것은 위험하다. 이 방법은 메시지의 출처와 신뢰성을 보장할 수 없으며, 분쟁이나 의심이 있으면 문제를 일으킬 수 있다.

사용자가 그룹 간에 데이터 또는 자금을 분리하려면 여러 개인키를 생성하고 관리해야 한다. 너무 많은 키는 불편하게 만들며, 다른 모든 참여자와 새롭게 공유하는 키는 보안을 약화할 수 있다.

**단점**

개인키와 공개키를 사용하는 데 단점은 이들이 지닌 몇 가지 심각한 약점과 관련이 있다. 첫째, 개인키를 잃어버리면 암울한 결과를 만나게 된다. 다시 말해, 개인키의 분실은 수신된 데이터의 암호를 해독할 수 있는 사람이 아무도 없음을 의미한다. 가상화폐 측면에서 지갑 소유자는 개인키가 분실되면 지갑에 접근할 수 없게 된다.

### 공개키 또는 개인키 암호화를 언제 선택하면 좋을까?

사용자의 선호도와 편의에 따라 암호화 방법을 선택할 수 있다. 대칭 암호화는 속도 및 데이터 보호를 중시하는 경우에 유용하다. 예를 들어, AES(Advanced Encryption Standard)가 채택된 대칭 암호화 알고리즘은 애플(Apple) 및 마이크로소프트(Microsoft)와 같은 기업에서 사용된다.

또한, 데이터 저장에 초점을 맞춘다면 대칭 암호화가 이상적이다. 암호화된 데이터가 장치에 저장되고 해당 데이터가 전송되지 않을 때에도 잘 작동한다.

속도 및 컴퓨팅 성능보다 보안 강화가 우선이면 비대칭 암호화가 좋다. 대칭 암호화로는 인증이 지원되지 않으므로 신원 확인이 필요할 때는 비대칭 암호화 사용을 해야한다. 블록체인 기술에서는 신원 확인에 의존해 거래를 승인한다. 따라서, 가상화폐 거래자와 투자자들은 비대칭 암호화 사용을 선호할 것이다.

### PKI란

- 비대칭 암호화 사용
- 개인키와 공개키를 생성
- 개인키는 개인만이 소유
- 공개키는 공개시켜서 모두가 접근 가능
- 위 사항을 응용하는 제반 환경을 지칭

**공개키 암호화와 전자서명**을 사용할 수 있게 기반을 마련해둔 것이 **PKI(Public Key Infrastructure)**이다.

**실제 세계에서 PKI가 어떻게 사용되는가**

비대칭 암호화는 대칭 암호화에 비해 속도가 느리다. 이 속도차이 때문에 현실세계에서는 살짝 복잡한 구조를 이용한다.

![Untitled](PKI%20a06de/Untitled%201.png)

공개키 암호화에 쓰이는 포맷이다. 물론 이보다 더 자세히 들어가면 복잡하지만, 개념적으로 이해를 위해 이 정도로도 충분하다. 앞에서 설명했듯이 공개키 암호화의 핵심은 받을 당사자만 풀어볼 수 있게 당사자의 공개키로 내용을 암호화하는 것이 목적이다.

그런데 위의 그림을 보면 임시 대칭키를 생성한다. 이 이유가 바로 속도 차이이다. 평문(Plain Text)이 만약 크기가 많이 크다면 이를 공개키를 이용해서 암호화하는데 시간이 많이 걸린다. 그래서 임시 대칭키를 자동으로 생성하고 이 대칭키로 평문을 암호화해서 싸이퍼문(Chiper Text)로 변경한다. 그리고 그 생성한 대칭키를 메시지를 받을 A의 공개키로 암호화한다. 이 암호화된 임시 대칭키를 풀 수 있는 사람은 세상에 A밖에 없다. 그래서 Chiper Text와 A의 공개키로 암호화한 Encrypted Key를 한꺼번에 A에게 보내면 A는 Encrypted Key를 자신의 개인키로 해독해서 임시 대칭키를 얻어내고 그 임시 대칭키로 다시 Chiper Text를 해독한다. 그러면 평문을 얻어낼 수 있다.

![Untitled](PKI%20a06de/Untitled%202.png)

전자서명 프로세스의 간단한 설명이다. 전자서명은 보낸 당사자가 보냈다는 것을 확인하는 절차이다. 즉 평문 자체를 암호화할 필요가 없다는 것이다. 따라서 평문을 암호화 해시 함수로 축약을 하고 그 축약된 결과를 개인키로 암호화한다. 이 것을 Signature라고 편의상 부르겠다. (16바이트 아니면 20바이트를 암호화하기 때문에 속도가 빠르다.) 이 암호화한 결과와 평문을 함께 받을 사람에게 보낸다. 그러면 메시지를 받는 사람은 보낸 사람의 공개키를 구해서(공개키이기 때문에 쉽게 구할 수 있다.) Signature를 해독한다. 그러면 축약된 결과가 나오면 같이 들어있는 평문을 암호화 해시 함수로 축약을 하고 그 결과를 앞에서 Signature를 해독한 결과와 비교한다. 같다면 A가 보낸 문서임을 확신할 수 있다. 말 그대로 서명을 확인하는 것이다.

### 공인 인증서란?

PKI의 기본 가정 중에서 개인키는 자신만이 소유하고, 공개키는 공개해서 다른 사람도 쉽게 구할 수 있다고 했다. 사실 PKI란 이런 일이 쉽게 가능하도록 인프라를 갖춰 두는 것이다.

그래서 **공인 인증 기관(CA, Certificate Authority)**이 등장한다. 인증서 비밀번호니, 인증서를 다운받느니, 모든 것이 인증서에 집중되어 있는 것처럼 보이지만 사실 가장 중요한 것은 개인키이다. 공인 인증 기관은 인증서를 발행하는 것이 주요 업무가 아니라 실은 개인키와 공개키 쌍을 만들고 자신이 그 키들을 만들었다고 인증서를 발행한다.

즉 제일 중요한 개인키와 공개키 쌍을 만들고, 그 개인키를 공인 인증 기관에서 적법한 절차를 통해서 만들었다고 인증서를 발행하는 것이다. (명품백이나 보석류를 사면 주는 인증서나, 강아지 분양 보증서 등등하고 연관지으면 명확할 것이다.) 그 개인키를 보증하기 위해서 그 쌍이 되는 공개키가 바로 인증서에 들어 있다. 그리고 그 인증서를 공인 인증 기관이 정식으로 발행했다는 것을 알리기 위해서 ‘공인 인증 기관의 전자 서명' 이 바로 인증서에 들어있다. (그리고 인증서의 대상, 유효기간 등등도 포함되어 있다.) 그리고 나서 이 인증서는 신청한 사람한테만 주는 것이 아니라, 공개된 위치에 저장해서 요청하는 사람에게 내려보내 줄 수 있는 시스템이 갖춰져 있다. (보통 공인 인증 기관의 LDAP에 저장된다.)

그래서 은행에서 발급받는 ‘공인 인증서' 라는 것은 실은 ‘개인키+인증서' 쌍으로 되어 있다. Windows 사용자들은 NPKI 폴더를 뒤져서 자신의 CN 폴더 안에 저장된 파일을 살펴보면 알 수 있다.

### 은행 사이트에서 이체할 때 입력하는 ‘인증서 비밀번호' 는?

그러면 공개가 원칙인 인증서에 왜 비밀번호가 필요한지 궁금할 것이다. 이 비밀번호는, 바로 개인키에 대한 비밀번호이다. 개인만이 소유해야 하는 개인키에 대한 아무런 보안 장치 없이 공개되어 있으면 곤란할 것이다. 그래서 개인키에는 기본적으로 저장하는 형식이 있다. (물론 비밀번호가 필요한 형식이다.) PKCS7이나 PCKS12가 바로 그것이다.

> 참고자료: 
[https://bitkr.com/blockchain-kr/private-keys-vs-public-keys-differences/](https://bitkr.com/blockchain-kr/private-keys-vs-public-keys-differences/)
[https://crazia.tistory.com/entry/PKI-PKI-의-기본-개념-간단-설명](https://crazia.tistory.com/entry/PKI-PKI-%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EA%B0%9C%EB%85%90-%EA%B0%84%EB%8B%A8-%EC%84%A4%EB%AA%85)
>